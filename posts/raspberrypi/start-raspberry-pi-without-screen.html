<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="Personal blog site">
        <title>夜色残阳 | 博客 - 树莓派折腾笔记 — 无显示器情况下连接使用树莓派</title>
        <link rel="stylesheet" type="text/css" href="../../static_dist/css/default.css" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-122703565-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-122703565-1');
        </script>
    </head>
    <body>
        <header class="header">
  <nav class="header__name">
      <a href="../../">夜色残阳の杂货铺子</a>
  </nav>
  <nav class="header__navigation">
      <a href="../../blog.html">Blog</a>
      <!-- <a href="/archive.html">Archive</a> -->
      <a href="../../about.html">About</a>
      <a href="https://github.com/nodew">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github">
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
      </a>
  </nav>
</header>

        <div class="content post">
  <h3 class="post-title">树莓派折腾笔记 — 无显示器情况下连接使用树莓派</h3>
  <div class="post-date">August  2, 2018</div>
  <div class="post-body">
    <p>最近倒腾东西，翻出了几年前入手的一个raspberry pi 2代 b+的板子，上面都蒙了一层灰，开机后发现还能用。发挥环保主义的精神，废物再利用起来。但是现在遇到的问题是：一、手边上没有显示器，二、网上经常检索到的另一种方法是通过网线直连，共享pc的网络给树莓派，然后再通过ssh登录树莓派，这种方法的问题在于我一台mac，一台surface都没有网线的端口，又不想专门为这个再买一个适配器。</p>
<p>那就完全没有方法了吗？当然不是的。</p>
<h2 id="环境">环境</h2>
<ul>
<li><p>2代树莓派（3代树莓派和 Pi Zero W 应该都是可以的）</p></li>
<li><p>USB Wi-Fi 适配器 (如果是3代的话，内置Wi-Fi支持，这个不是必须的)</p></li>
<li><p>8GB SD卡</p></li>
<li><p>电源</p></li>
<li><p>个人 Wi-Fi</p></li>
</ul>
<h2 id="安装镜像">安装镜像</h2>
<p>在树莓派的<a href="https://www.raspberrypi.org/downloads/">官网</a>上下载最新的 <code>Raspbian Jessie</code> 的镜像或者 <code>Raspbian Stretch</code> 的镜像。我这里下使用的是最新的 <code>2018-06-07-raspbian-stretch.img</code>。如果后面只想在终端中使用的话，完全可以下载对应的 lite 版本。</p>
<p>镜像下载好了之后，写到你的SD卡里面就可以了。Windows下可以使用比较经典的 <code>Win32DiskImager</code>，Mac下推荐开源的 <a href="https://github.com/resin-io/etcher">Etcher</a>，或者直接使用 <code>diskutil</code> 也是可以的，相关使用这里不再赘述。</p>
<h2 id="配置-wi-fi-和-ssh">配置 Wi-Fi 和 SSH</h2>
<p>镜像写入之后会挂载一个<code>boot</code>的卷。Windows下可以直接通过资源管理工具打开。Mac下建议使用命令行。</p>
<h3 id="启用-ssh">启用 SSH</h3>
<p>树莓派默认情况下是没有打开ssh连接的，在 <code>boot</code> 卷的根路径下新建一个名叫 <code>ssh</code>的空文件，树莓派启动的时候就会开启ssh的功能。</p>
<pre class="shell"><code>$ touch ssh</code></pre>
<h3 id="wi-fi-连接设置">Wi-Fi 连接设置</h3>
<p>在 <code>boot</code> 卷的根路径下新建一个名叫 <code>wpa_supplicant.conf</code>的文件。树莓派启动之后，发现 <code>boot</code> 下面有这个文件的话，会把这个文件拷贝到 <code>/etc/wpa_supplicant/</code>路径下面，这就是我们树莓派的 Wi-Fi 连接的配置文件。</p>
<p>下面来看一下这个文件应该怎么写。</p>
<p>如果你的系统是 <code>Raspbian Jessie</code>的话，填入以下配置</p>
<pre class="shell"><code>network={
    ssid=&quot;你的Wi-Fi名称&quot;
    psk=&quot;Wi-Fi密码&quot;
    key_mgmt=WPA-PSK
}</code></pre>
<p>如果是系统是 <code>Raspbian Stretch</code> 的话，配置如下</p>
<pre class="shell"><code>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
network={
    ssid=&quot;你的Wi-Fi名称&quot;
    psk=&quot;Wi-Fi密码&quot;
    key_mgmt=WPA-PSK
}</code></pre>
<p>多了一行 ctrl_interface 的配置，但是目前我还不太清楚这个到底是什么含义。有知道的朋友可以在评论区指出。</p>
<p>注意：这里填写的 Wi-Fi 应该和 PC 当前连接的 Wi-Fi 保持一致。</p>
<h3 id="发现-ip">发现 IP</h3>
<p>到这里我们距离连接上树莓派就之差一步之遥了，通过 SSH 的方式登录树莓派还需要知道树莓派在局域网中的 IP 地址。</p>
<p>我们把SD卡插到树莓派上，然后通电。这时候红色指示灯亮起，表示说已通电。绿色指示灯闪烁，表示树莓派在往SD卡读写数据。等绿灯闪烁一段时间基本不闪之后，就说明我们的树莓派已经开机成功。</p>
<p>这时候，如果我们的PC是 Windows，一个简单的方法就是在 powershell 输入<code>arp -a</code>，其中，返回的列表后面类型对应是动态类型的，就是我们接入的设备。</p>
<p>分别在树莓派开机和关机的状态下执行，多出来的那个动态连接地址就是树莓派的 IP 地址。</p>
<p>如果喜欢图形化界面的话，Windows 下可以使用<code>Advanced Ip Scanner</code>，Mac下有 <code>LanScan</code>, 可以直接从 hostname 辨别出raspberry pi。</p>
<h3 id="ssh-登录">SSH 登录</h3>
<pre class="shell"><code>$ ssh pi@ip_address_of_your_raspberry_pi</code></pre>
<p>然后用默认密码<code>raspberry</code>就可以登录设备了。</p>
<h2 id="使用串口连接树莓派">使用串口连接树莓派</h2>
<p>树莓派作为一款功能强大的开源硬件，肯定是支持串口通信的。但是也有两个问题，第一、树莓派本身并没有默认开启串口通信功能，第二，很多开发者如果本身不是做硬件的，可能不会有 USB 转 TTL 的连接线。我这里是刚好有一根上古遗留下来的（如果没有，但是对这种方式敢兴趣，也可以直接在万能的淘宝上淘一根，10块钱左右）</p>
<h3 id="usb-转-ttl-线说明">USB 转 TTL 线说明</h3>
<p>一端是USB接口，另一端4根出线，颜色不同。</p>
<ul>
<li><p>红色，电源供电，一般是3V或者5V，如果要用它给树莓派供电的话，树莓派的工作电压是5V</p></li>
<li><p>黑色，接地</p></li>
<li><p>白色，信号输入</p></li>
<li><p>绿色，信号输出</p></li>
</ul>
<h3 id="开启-uart">开启 UART</h3>
<p>分两种情况：</p>
<p>一、通过上面的方法或者其他方式，已经能连接使用树莓派了。这种情况下，直接在树莓派对终端中输入</p>
<pre class="shell"><code>$ sudo raspi-config</code></pre>
<p>在弹出对对话框中选择 <code>Interfacing Options</code>，进入下一个对话框，然后选择<code>Serial</code>，最后选择 <code>YES</code>，回到命令行后重启树莓派就可以了。</p>
<p>二、回到我的使用场景，按上面的步骤安装好了镜像，但是还没有启动系统。</p>
<p>这种时候的一个解决方案是，在 <code>boot</code> 卷的根路径下找到 <code>cmdline.text</code> 和 <code>config.text</code>两个文件。首先打开 <code>cmdline.text</code>，检查文件里面是不是有 <code>console=serial0,115200</code> 的这个配置，115200是树莓派的波特率，一般都是已经有的，如果没有，行尾加上这个配置。接下来打开 <code>config.text</code> 这个文件，在新行追加 <code>enable_uart=1</code>，0 - 关闭，1 - 开启。</p>
<p>然后把 SD 卡插入树莓派，开机。接下来就可以开始连接我们的树莓派了。</p>
<h3 id="uart-连接">UART 连接</h3>
<p><a href="https://pinout.xyz/" class="uri">https://pinout.xyz/</a> 这是一个很有用的网站，上面列出了树莓派的GPIO各个管脚的作用，点击管脚我们可以查看相应的说明，对我们做GPIO相关的开发很用帮助。</p>
<p>这里先打开这个网站，找到标注为 <code>RXD</code> 和 <code>TXD</code> 的这两个管脚的位置。<code>TXD</code>是树莓派 UART 的输出，<code>RXD</code>是树莓派的输入。</p>
<p>然后把USB转TTL线的黑色线接树莓派的<code>Ground</code>，白色接<code>TXD</code>，绿色接<code>RXD</code>，如果已经有电源供电，红线可以不接。</p>
<p>连接好了之后，如果我们在 Windows 环境下，可以使用 putty。打开 putty，选择串口通信，Serial line 输入 <code>COM3</code>，Speed 输入 <code>115200</code>，即树莓派的波特率。进去之后，我们看到一个小黑窗，这时候，键盘输入回车，树莓派就会让我们输入用户名以及密码，输入正确之后我们就可以为所欲为了。</p>
<p>如果是在 Mac 环境下的话，我们把 USB 插入 Mac之后，我们的<code>/dev</code>路径下就会多出一个设备，假如叫做 <code>cu.usbserial</code>，这时候我们可以借助两个命令行工具。一个是 <code>minicom</code>，另一个是 <code>screen</code>。</p>
<pre class="shell"><code>$ brew install minicom

# or

$ brew install screen</code></pre>
<p>安装好之后，如下，使用相应的命令行</p>
<pre class="shell"><code>$ minicom -o -D /dev/cu.usbserial -b 115200

# or

$ screen /dev/cu.usbserial 115200</code></pre>
<p>再和 Windows 一样，输入用户名密码就可以连接使用了。</p>
<p>以上。</p>
<h2 id="reference">Reference</h2>
<p>1、 <a href="https://styxit.com/2017/03/14/headless-raspberry-setup.html">Headless Raspberry Pi setup with wifi</a></p>
<p>2、 <a href="https://www.thepolyglotdeveloper.com/2017/02/connect-raspberry-pi-pi-zero-usb-ttl-serial-cable/">Connect To A Raspberry Pi And Pi Zero With A USB To TTL Serial Cable</a></p>
  </div>
  <div id="comments"></div>
</div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: location.href,
  owner: 'nodew',
  repo: 'blog',
  oauth: {
    client_id: '3f36214bd191119338cc',
    client_secret: '8527738f4cbb1a4b916c87d8573d57c9c4e57413',
  },
});
gitment.render('comments')
</script>
<script>
  if (window.localStorage) {
    window.localStorage.setItem('last-read-post', location.href);
  }
</script>

        <footer class="footer">
  <div class="copyright">Copyright © 2017-2018 WANGQIAO.ME. All rights reserved.</div>
  <div class="hakyll">
    Site generated by
    <a href="https://jaspervdj.be/hakyll/">Hakyll</a>
  </div>
</footer>
    </body>
    <script src="../../static_dist/js/index.js"></script>
</html>
